<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
	<meta property="og:url" content="/docs/advanced-features.html" />
	<meta property="og:site_name" content="Infer"/>
	<meta property="og:title" content="高级用法" />
	<meta property="og:image" content="/static/og_image.png" />
	<meta property="og:description" content="" />

  <link rel="stylesheet" type="text/css" media="screen" href="/css/main.css">
	<link rel="stylesheet" type="text/css" href="//cloud.typography.com/7491092/701726/css/fonts.css" />
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.5/styles/default.min.css">
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
  
  <link rel="icon" href="static/favicon.png" type="image/x-icon">
  
  <base href="/" />
  
  <script src="/static/react-with-addons-0.13.1.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.5/highlight.min.js"></script>

  <title>高级用法</title>
  <meta name="description" content="">

  <link rel="canonical" href="/docs/advanced-features.html">
  <link rel="alternate" type="application/rss+xml" title="Infer" href="/feed.xml" />
</head>

  <body>    
    <div id="fixed_header" class="fixedHeaderContainer visible">
  <header>
    <a href=""><img src="/static/logo.png" /><h2>Infer</h2></a>
    <div class="navigationWrapper navigationFull" id="flat_nav">
      <nav class="navigation">
        <ul>
          
          <li class="navItem navItemActive">
            <a href=docs/getting-started.html>文档</a>
          </li>
          
          <li class="navItem ">
            <a href=support.html>帮助和支持</a>
          </li>
          
          <li class="navItem ">
            <a href=blog/>博客</a>
          </li>
          
          <li class="navItem ">
            <a href=http://github.com/facebook/infer>Github</a>
          </li>
          
        </ul>
      </nav>
    </div>
    <div class="navigationWrapper navigationSlider" id="navigation_wrap"></div>
  </header>
  <script>
    var event = document.createEvent('Event');
    event.initEvent('slide', true, true);
    document.addEventListener('slide', function (e) {
      document.body.classList.toggle('sliderActive');
    }, false);
    var navData = [
      
      {
        href       : "docs/getting-started.html",
        text       : "文档",
      },
      
      {
        href       : "support.html",
        text       : "帮助和支持",
      },
      
      {
        href       : "blog/",
        text       : "博客",
      },
      
      {
        href       : "http://github.com/facebook/infer",
        text       : "Github",
      },
      
    ];
  </script>
  <script type="text/javascript">  
    var Nav = React.createClass({displayName: "Nav",
      getInitialState: function() {
        return {
          currentPath: window.location.pathname,
          slideoutActive: false,
        };
      },
      getDefaultProps: function() {
        return {
          data: navData,
        }
      },
      handleClick: function(id) {
        this.setState({
          slideoutActive: false,
        });
        document.dispatchEvent(event);
      },
      handleSlide: function(id) {
        this.setState({
          slideoutActive: !this.state.slideoutActive,
        });
        document.dispatchEvent(event);
      },
      render: function() {
        var classes = React.addons.classSet({
          'navSlideout': true,
          'navSlideoutActive': this.state.slideoutActive,
        });
        var navClasses = React.addons.classSet({
          'slidingNav': true,
          'slidingNavActive': this.state.slideoutActive,
        });
        return (
          React.createElement("div", null, 
            React.createElement("div", {className: classes, onClick: this.handleSlide}, 
              React.createElement("i", {className: "fa fa-bars"})
            ), 
            React.createElement("nav", {className: navClasses}, 
              React.createElement("ul", null, 
                this.props.data.map(this.renderNavItems)
              )
            )
          )
        );
      },
      renderNavItems: function(child, index) {
        var classes = React.addons.classSet({
          'navItem': true,
          'navItemActive': this.state.currentPath === child.href,
        });
        return (
          React.createElement("li", {key: index, className: classes}, 
            React.createElement("a", {onClick: this.handleClick, href: child.href}, child.text)
          )
        );
      },
    });

    function render(navData) {
      React.render(
        React.createElement(Nav, {data: navData}),
        document.getElementById('navigation_wrap')
      );
    }
    render(navData);
  </script>
</div>

    <div class="navPusher">
      <div class="mainContainer blogContainer postContainer">
  <div id="main_wrap" class="wrapper mainWrapper">
    <div>
</div>
<nav class='toc' id="doc_nav"></nav>
<script>
  var docnavData = [
    
    {
      group     : "开始使用",
      items     : [
        
        
          
            
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
        {
          key : "/docs/getting-started.html",
          title : "开始使用",
          url : "/docs/getting-started.html",
        },
        
        
          
        
          
            
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
        {
          key : "/docs/hello-world.html",
          title : "Hello, World!",
          url : "/docs/hello-world.html",
        }
        
      ],
    },
    
    {
      group     : "用户使用参考",
      items     : [
        
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
            
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
        {
          key : "/docs/infer-workflow.html",
          title : "Infer 的工作机制",
          url : "/docs/infer-workflow.html",
        },
        
        
          
        
          
        
          
        
          
        
          
            
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
        {
          key : "/docs/analyzing-apps-or-projects.html",
          title : "分析 APP 或者其他项目",
          url : "/docs/analyzing-apps-or-projects.html",
        },
        
        
          
        
          
        
          
        
          
        
          
        
          
            
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
        {
          key : "/docs/checkers.html",
          title : "Infer : Checkers",
          url : "/docs/checkers.html",
        },
        
        
          
        
          
        
          
        
          
        
          
        
          
        
          
            
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
        {
          key : "/docs/eradicate.html",
          title : "Infer : Eradicate",
          url : "/docs/eradicate.html",
        },
        
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
            
          
        
          
        
          
        
          
        
          
        
          
        
          
        
        {
          key : "/docs/install-from-source.html",
          title : "源码安装",
          url : "/docs/install-from-source.html",
        },
        
        
          
        
          
        
          
        
          
            
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
        {
          key : "/docs/advanced-features.html",
          title : "高级用法",
          url : "/docs/advanced-features.html",
        },
        
        
          
        
          
        
          
            
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
        {
          key : "/docs/adding-models.html",
          title : "Adding models",
          url : "/docs/adding-models.html",
        }
        
      ],
    },
    
    {
      group     : "Foundations",
      items     : [
        
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
            
          
        
          
        
          
        
          
        
          
        
          
        
        {
          key : "/docs/about-Infer.html",
          title : "关于 Infer",
          url : "/docs/about-Infer.html",
        },
        
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
            
          
        
          
        
          
        
          
        
        {
          key : "/docs/separation-logic-and-bi-abduction.html",
          title : "Separation logic and bi-abduction",
          url : "/docs/separation-logic-and-bi-abduction.html",
        },
        
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
            
          
        
          
        
          
        
          
        
          
        
        {
          key : "/docs/limitations.html",
          title : "Limitations, etc",
          url : "/docs/limitations.html",
        }
        
      ],
    },
    
    {
      group     : "Bug 类型参考",
      items     : [
        
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
            
          
        
        {
          key : "/docs/infer-bug-types.html",
          title : "Infer bug types",
          url : "/docs/infer-bug-types.html",
        },
        
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
            
          
        
          
        
          
        
        {
          key : "/docs/checkers-bug-types.html",
          title : "校验器报告的问题类型",
          url : "/docs/checkers-bug-types.html",
        },
        
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
            
          
        
          
        
        {
          key : "/docs/eradicate-warnings.html",
          title : "Eradicate warnings",
          url : "/docs/eradicate-warnings.html",
        }
        
      ],
    },
    
  ];
</script>
<script type="text/javascript">  
  var DocNav = React.createClass({displayName: "DocNav",
    getInitialState: function() {
      return {
        toggleActive: false,
      };
    },
    getDefaultProps: function() {
      return {
        currentDoc: "高级用法",
        currentGroup: "User Guide",
        data: docnavData,
      }
    },
    handleSlide: function(id) {
      this.setState({
        toggleActive: !this.state.toggleActive,
      });
    },
    render: function() {
      var classes = React.addons.classSet({
        'navToggle': true,
        'navToggleActive': this.state.toggleActive,
      });
      var navClasses = React.addons.classSet({
        'toggleNav': true,
        'toggleNavActive': this.state.toggleActive,
      });
      return (
        React.createElement("div", {className: navClasses}, 
          React.createElement("section", null, 
            this.props.data.map(this.renderNavGroups)
          ), 
          React.createElement("div", {className: classes, onClick: this.handleSlide}, React.createElement("i", {className: "fa fa-chevron-circle-down"}))
        )
      );
    },
    renderNavGroups: function(child, index) {
      var classes = React.addons.classSet({
        'navGroup': true,
        'navGroupActive': this.props.currentGroup === child.group,
      });
      return (
        React.createElement("div", {className: classes, key: index}, 
          React.createElement("h3", null, child.group), 
          React.createElement("ul", null, 
            child.items.map(this.renderNavItems)
          )
        )
      );
    },
    renderNavItems: function(child, index) {
      var itemClasses = React.addons.classSet({
        'navListItem': true,
        'navListItemActive': this.props.currentDoc === child.title,
      });
      var classes = React.addons.classSet({
        'navItem': true,
        'navItemActive': this.props.currentDoc === child.title,
      });
      return (
        React.createElement("li", {className: itemClasses, key: index}, React.createElement("a", {className: classes, href: child.url},  child.title))
      );
    },
  });

  function docNavRender(docnavData) {
    React.render(
      React.createElement(DocNav, {data: docnavData}),
      document.getElementById('doc_nav')
    );
  }
  docNavRender(docnavData);
</script>
    <div class="post">
  <header class="post-header">
    <h1 class="post-title">高级用法</h1>
  </header>

  <article class="post-content">
   
      <p>如果你想详细了解 Infer 具体是如何工作的，或者想为 Infer 添砖加瓦，这个章节我们会具体讨论诸如调试选项，获取方法详细定义的办法等细节问题。</p>

<h2 id="结果文件夹结构">结果文件夹结构</h2>

<p>检测成功运行之后，分析结果会被放入一个默认文件夹，<code>infer-out</code>：</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">infer-out
├── captured/
├── log/
├── multicore/
├── sources/
├── specs/
├── bugs.txt
├── procs.csv
├── report.csv
├── report.json
└── stats.json
</code></pre></div>
<ul>
<li><code>captured/</code> 包含了 Infer 分析需要的每个文件的信息，具体看 <a href="docs/advanced-features.html#captured-folder">下面</a></li>
<li><code>log/</code>, <code>multicore/</code>, 和 <code>sources/</code> 文件夹是分析器内部驱动所需。</li>
<li><code>specs/</code> 包含了所分析的各个方法的 <a href="docs/advanced-features.html#print-the-specs">参数指标</a>，Infer 据此推断文件。</li>
<li><code>bugs.txt</code>, <code>report.csv</code>, 和 <code>report.json</code> 为三种不同格式的分析结果。</li>
<li><code>procs.csv</code> and <code>stats.json</code> 包含 debug 信息的分析结果。</li>
</ul>

<h3 id="捕获文件夹">捕获文件夹</h3>

<p>每个被捕获进行分析的文件在 <code>infer-out/captured</code> 下都有一个对应的文件夹。比如有一个文件名为 <code>example.c</code>，那么便会有一个文件夹 <code>infer-out/captured/example.c/</code>：</p>

<ul>
<li><code>example.c.cfg</code></li>
<li><code>example.c.cg</code></li>
<li><code>example.c.tenv</code></li>
</ul>

<p><code>.cfg</code>， <code>.cg</code> 和 <code>.tenv</code> 后缀的文件包含了所分析文件的中间表示，这些数据传送给 Infer 的后端程序进行分析。 这些文件包含了序列化后的 OCaml 数据结构。<code>.cfg</code> 文件包含了代码文件中每个函数或方法的控制流程。<code>.cg</code> 包含了代码文件中定义的函数的调用关系，以及该文件对外部函数的调用关系。 <code>.tenv</code> 包含了代码文件中定义和用到的类型。</p>

<h2 id="debug-模式">Debug 模式</h2>

<p>通过 debug 选项 <code>infer --debug -- &lt;build command&gt;</code> 可输出调试信息。当使用 <code>make</code> 和 <code>clang</code> 的时候，需要加一个额外的前端调试选项：</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">infer --frontend_debug --debug -- make example.c
</code></pre></div>
<p>在每个捕获文件夹中，会有一个 <code>icfg.dot</code> 文件，这个文件是 <code>.cfg</code> 和 <code>call_graph.dot</code> 文件的图表示，也就是说，这是调用关系的图表示。</p>

<p>另外，在 <code>infer-out/captured</code> 文件夹下，每个文件还有一个 html 页面文件。这个文件包含了源代码文件，文件的每一行，都有链接指向该行代码对应的控制流程的节点。点击各个节点的链接可以查看各个节点的对应的符号执行的详细情况。如果开启了 <code>--no_test</code> 选项，节点详细情况页面将会包含打印出来的所有符号执行的情况。</p>

<h2 id="输出方法的详细定义">输出方法的详细定义</h2>

<p>使用 <code>InferPrint</code> 可以输出 Infer 创建的方法的详细定义，你可以输出一个方法或者所有方法的详细定义，如下：</p>
<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">class</span> <span class="nc">Hello</span> <span class="o">{</span>
    <span class="kt">int</span> <span class="n">x</span><span class="o">;</span>
    <span class="kt">void</span> <span class="nf">setX</span><span class="o">(</span><span class="kt">int</span> <span class="n">newX</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">x</span> <span class="o">=</span> <span class="n">newX</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div>
<p>运行：</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">    infer -- javac Hello.java
</code></pre></div>
<p><code>setX</code> 的详细定义储存在 <code>infer-out/specs</code>，我们可以如下打印输出：</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">    InferPrint infer-out/specs/Hello.setX<span class="o">{</span>98B5<span class="o">}</span>:void.specs
</code></pre></div>
<p>Java 方法的命名规则为，<code>&lt;class name&gt;.&lt;method name&gt;</code>，输出如下：</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">Procedure: void Hello.setX<span class="o">(</span>int<span class="o">)</span>
void void Hello.setX<span class="o">(</span>int<span class="o">)(</span>class Hello *this, int newX<span class="o">)</span>
Timestamp: 1
Status: INACTIVE
Phase: RE_EXECUTION
Dependency_map:
TIME:0.006893 s TIMEOUT:N SYMOPS:34 CALLS:0,0
ERRORS:
--------------------------- <span class="m">1</span> of <span class="m">1</span> <span class="o">[</span>nvisited: <span class="m">4</span> <span class="m">5</span> 6<span class="o">]</span> ---------------------------
PRE:
<span class="nv">this</span> <span class="o">=</span> val<span class="nv">$1</span>: <span class="p">;</span>
<span class="nv">newX</span> <span class="o">=</span> val<span class="nv">$3</span>: <span class="p">;</span>
this<span class="p">|</span>-&gt;<span class="o">{</span>Hello.x:val<span class="nv">$2</span><span class="o">}</span>:
POST <span class="m">1</span> of 1:
<span class="nv">this</span> <span class="o">=</span> val<span class="nv">$1</span>: <span class="p">;</span>
<span class="k">return</span> <span class="o">=</span> val<span class="nv">$4</span>: <span class="p">;</span>
<span class="nv">newX</span> <span class="o">=</span> val<span class="nv">$3</span>: <span class="p">;</span>
this<span class="p">|</span>-&gt;<span class="o">{</span>Hello.x:newX<span class="o">}</span>:
----------------------------------------------------------------
</code></pre></div>
<p>以上可见，方法执行最开始，<code>this</code> 需要初始化，在方法最后，<code>x</code> 和 <code>newX</code> 是相等的。</p>

<p>如果要打印结果文件夹下所有的方法的详细定义：</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">InferPrint -results_dir infer-out
</code></pre></div>
<h2 id="运行内部测试用例">运行内部测试用例</h2>

<p>在 Infer 的代码中，有很多测试用例。我们使用这些测试用例来检验 Infer 行为的正确性。</p>

<p>测试使用 Facebook 的另外一个开源项目 <a href="http://buckbuild.com/">Buck</a> 来构建项目，我们有一个 <code>inferTest</code> 脚本来运行这些测试用例。使用这个脚本需要确保 buck 路径在 PATH 变量中。</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">inferTest java    <span class="c"># Run the tests about Java analysis</span>
inferTest clang   <span class="c"># Run the tests about C and Objective-C analysis</span>
inferTest c       <span class="c"># Run the tests about C analysis</span>
inferTest objc    <span class="c"># Run the tests about Objective-C analysis</span>
</code></pre></div>
    
  </article>
  


  
  
  
    
  
    
  

  
  
  
    
  
    
  
    
  
    
  
    
  
    
      
      
    
  
    
  

  
  
  
    
  
    
  
    
  

  
  
  
    
  
    
  
    
  


  <div class="docPagination">
    
    
    
    
      
    
    
      
    
    
    
    <div class="pager pagingPrevious"><a href="/docs/install-from-source.html">&lsaquo; <span class="pagerLabel">Previous</span><span class="pagerTitle">源码安装</span></a></div>
    
    
    <div class="pager pagingNext"><a href="/docs/adding-models.html"><span class="pagerTitle">Adding models</span><span class="pagerLabel">Next</span> &rsaquo;</a></div>
    
  </div>

</div>
  </div>
</div>


      <div class="footerContainer">
  <div id="footer_wrap" class="wrapper footerWrapper">
    <section id="fb_oss" class="fbOpenSourceFooter">
      <a href="https://code.facebook.com/projects/" target="_blank"><img src="/static/oss_logo.png" alt="Facebook Open Source" title="Facebook Open Source" /></a>
    </section>
    <script>hljs.initHighlightingOnLoad();</script>
  </div>
</div>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-43024238-10', 'auto');
  ga('send', 'pageview');
</script>


    </div>
  </body>

</html>
